<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GTM/GA4 Form Tracking Demo - Good vs Bad</title>

  <!-- Consent Mode v2 Default -->
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}

    // Check for stored consent
    const storedConsent = localStorage.getItem('user_consent_preferences');

    if (storedConsent) {
      gtag('consent', 'default', JSON.parse(storedConsent));
    } else {
      // Default to denied (GDPR compliant)
      gtag('consent', 'default', {
        'ad_storage': 'denied',
        'ad_user_data': 'denied',
        'ad_personalization': 'denied',
        'analytics_storage': 'denied',
        'wait_for_update': 500
      });
    }
  </script>

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-MM6H8SQW');</script>
  <!-- End Google Tag Manager -->
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    h1 {
      text-align: center;
      color: white;
      margin-bottom: 40px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .demo-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-bottom: 40px;
    }
    
    .demo-card {
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    
    .demo-card h2 {
      margin-bottom: 10px;
      color: #333;
    }
    
    .badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
      margin-bottom: 20px;
    }
    
    .badge-good {
      background: #d4edda;
      color: #155724;
    }
    
    .badge-bad {
      background: #f8d7da;
      color: #721c24;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #555;
    }
    
    input, select, textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      font-family: inherit;
    }
    
    textarea {
      min-height: 100px;
      resize: vertical;
    }
    
    button {
      background: #667eea;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
      transition: background 0.3s ease;
    }
    
    button:hover {
      background: #764ba2;
    }
    
    .success-message {
      display: none;
      background: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
      padding: 15px;
      border-radius: 6px;
      margin-top: 15px;
    }
    
    .debug-section {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 6px;
      padding: 20px;
      margin-top: 30px;
    }
    
    .debug-section h3 {
      margin-bottom: 15px;
      color: #333;
    }
    
    .debug-output {
      background: #282c34;
      color: #61dafb;
      padding: 15px;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 200px;
      overflow-y: auto;
      word-break: break-all;
    }
    
    .info-box {
      background: #e7f3ff;
      border-left: 4px solid #667eea;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 4px;
    }
    
    .info-box p {
      color: #333;
      font-size: 14px;
      line-height: 1.6;
    }
    
    @media (max-width: 768px) {
      .demo-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div style="background: #fff3cd; border-bottom: 3px solid #856404; padding: 15px; text-align: center; margin-bottom: 20px;">
    <strong>üÜï Want to see server-side tracking implementation?</strong>
    <a href="index-server-side.html" style="color: #004085; text-decoration: underline; margin-left: 10px;">
      View Complete Client vs Server-Side Comparison ‚Üí
    </a>
  </div>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MM6H8SQW"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->
  
  <div class="container">
    <h1>üéØ GTM/GA4 Form Tracking: Good vs Bad</h1>
    
    <div class="demo-grid">
      <!-- GOOD Implementation -->
      <div class="demo-card">
        <h2>‚úÖ GOOD Implementation</h2>
        <span class="badge badge-good">Best Practice</span>
        
        <div class="info-box">
          <p><strong>Why this is good:</strong><br/>
          ‚Ä¢ Fires only on success<br/>
          ‚Ä¢ Clean dataLayer push<br/>
          ‚Ä¢ Anti-double-fire guard<br/>
          ‚Ä¢ Standard GA4 event</p>
        </div>
        
        <form id="good-form">
          <div class="form-group">
            <label for="good-name">Name *</label>
            <input type="text" id="good-name" required>
          </div>
          
          <div class="form-group">
            <label for="good-email">Email *</label>
            <input type="email" id="good-email" required>
          </div>
          
          <div class="form-group">
            <label for="good-topic">Topic *</label>
            <select id="good-topic" required>
              <option value="">Select...</option>
              <option value="support">Support</option>
              <option value="sales">Sales</option>
              <option value="partnership">Partnership</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Plan *</label>
            <input type="radio" id="good-basic" name="plan" value="basic" required>
            <label for="good-basic" style="display:inline;margin-left:8px">Basic</label><br/>
            <input type="radio" id="good-pro" name="plan" value="pro" required>
            <label for="good-pro" style="display:inline;margin-left:8px">Pro</label>
          </div>
          
          <button type="submit">Submit (Good)</button>
        </form>
        
        <div class="success-message" id="good-success">
          ‚úÖ Success! Event pushed to dataLayer (GTM will send to GA4)
        </div>
        
        <div class="debug-section">
          <h3>dataLayer Events</h3>
          <div class="debug-output" id="good-debug">Waiting for form submission...</div>
        </div>
      </div>
      
      <!-- BAD Implementation -->
      <div class="demo-card">
        <h2>‚ùå BAD Implementation</h2>
        <span class="badge badge-bad">Anti-pattern</span>
        
        <div class="info-box">
          <p><strong>Why this is bad:</strong><br/>
          ‚Ä¢ Fires on click (not success)<br/>
          ‚Ä¢ No validation<br/>
          ‚Ä¢ High cardinality fields<br/>
          ‚Ä¢ Counts failures</p>
        </div>
        
        <form id="bad-form" onsubmit="return false">
          <div class="form-group">
            <label for="bad-name">Name</label>
            <input type="text" id="bad-name">
          </div>
          
          <div class="form-group">
            <label for="bad-email">Email</label>
            <input type="email" id="bad-email">
          </div>
          
          <div class="form-group">
            <label for="bad-message">Message</label>
            <textarea id="bad-message"></textarea>
          </div>
          
          <button type="button" id="bad-submit">Submit (Bad)</button>
        </form>
        
        <div class="success-message" id="bad-success">
          ‚ö†Ô∏è Fired! (Even if invalid)
        </div>
        
        <div class="debug-section">
          <h3>dataLayer Events</h3>
          <div class="debug-output" id="bad-debug">Waiting for button click...</div>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // Initialize dataLayer (required before any pushes)
    window.dataLayer = window.dataLayer || [];

    // Unique per form load to correlate attempts
    const instanceId = `${Date.now()}_${Math.random().toString(16).slice(2)}`;
    
    // Anti-double-fire guard
    let goodSent = false;
    
    // GOOD FORM: Validation-first approach
    document.getElementById('good-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      // Prevent double-firing
      if (goodSent) return;
      
      // Get form values
      const name = document.getElementById('good-name').value;
      const email = document.getElementById('good-email').value;
      const topic = document.getElementById('good-topic').value;
      const plan = document.querySelector('input[name="plan"]:checked')?.value;
      
      // Validate before pushing to dataLayer
      if (!name || !email || !topic || !plan) {
        document.getElementById('good-debug').textContent = '‚ùå Validation failed - event NOT sent';
        return;
      }
      
      // Simulate async form submission (e.g., API call)
      await new Promise(resolve => setTimeout(resolve, 500));
      
      // Set guard
      goodSent = true;
      
      // ONLY push to dataLayer - GTM will handle sending to GA4
      window.dataLayer.push({
        event: 'form_submission_success',
        form_id: 'contact_us',
        instance_id: instanceId,
        form_type: 'lead',
        form_location: 'demo_page',
        form_fields: {
          topic: topic,
          plan: plan
        }
      });
      
      // Show success message
      document.getElementById('good-success').style.display = 'block';
      
      // Display pushed event for debugging
      document.getElementById('good-debug').textContent = JSON.stringify({
        event: 'form_submission_success',
        form_id: 'contact_us',
        instance_id: instanceId,
        form_type: 'lead',
        form_location: 'demo_page',
        form_fields: {
          topic: topic,
          plan: plan
        }
      }, null, 2);
    });
    
    // BAD FORM: Fires on click without validation
    document.getElementById('bad-submit').addEventListener('click', function() {
      // Push to dataLayer with high-cardinality field (bad practice)
      window.dataLayer.push({
        event: 'contact_form',
        form_name: 'Contact Form',
        message: document.getElementById('bad-message').value  // High cardinality!
      });
      
      // Show "success" even if form is invalid
      document.getElementById('bad-success').style.display = 'block';
      
      // Display pushed event
      const message = document.getElementById('bad-message').value;
      document.getElementById('bad-debug').textContent = JSON.stringify({
        event: 'contact_form',
        form_name: 'Contact Form',
        message: message.substring(0, 50) + (message.length > 50 ? '...' : '')
      }, null, 2);
    });
  </script>
</body>
</html>
