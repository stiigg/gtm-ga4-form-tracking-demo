<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GTM/GA4 Form Tracking: Client vs Server-Side Demo</title>

  <!-- Consent Mode v2 Default -->
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}

    const storedConsent = localStorage.getItem('user_consent_preferences');

    if (storedConsent) {
      gtag('consent', 'default', JSON.parse(storedConsent));
    } else {
      gtag('consent', 'default', {
        'ad_storage': 'denied',
        'ad_user_data': 'denied',
        'ad_personalization': 'denied',
        'analytics_storage': 'denied',
        'wait_for_update': 500
      });
    }
  </script>

  <!-- Google Tag Manager with Server-Side Transport URL -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-MM6H8SQW');</script>
  
  <!-- Configure GA4 with Server-Side Transport URL -->
  <script>
    // This routes GA4 traffic through your server container
    // Replace with your actual server container URL
    gtag('config', 'G-XXXXXXXXXX', {
      'transport_url': 'https://track.yourdomain.com',  // Your server container endpoint
      'first_party_collection': true
    });
  </script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .educational-notice {
      background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
      border: 3px solid #856404;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 30px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .educational-notice-header {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }

    .educational-notice-icon {
      font-size: 42px;
      margin-right: 15px;
    }

    .educational-notice h2 {
      margin: 0;
      color: #856404;
      font-size: 22px;
    }

    .educational-notice p {
      margin: 0 0 15px 0;
      color: #333;
      font-size: 15px;
      line-height: 1.6;
    }

    .notice-section {
      background: white;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 12px;
    }

    .notice-section p {
      margin: 0 0 8px 0;
      color: #333;
      font-weight: bold;
      font-size: 14px;
    }

    .notice-section ul {
      margin: 0;
      padding-left: 25px;
      color: #555;
      font-size: 14px;
    }

    .notice-section li {
      margin-bottom: 5px;
    }

    .notice-footer {
      background: #e7f3ff;
      border-left: 4px solid #0066cc;
      padding: 15px;
      border-radius: 4px;
      margin-top: 15px;
    }

    .notice-footer p {
      margin: 0;
      color: #333;
      font-size: 14px;
      line-height: 1.6;
    }

    .notice-footer a {
      color: #0066cc;
      text-decoration: underline;
      font-weight: 600;
    }

    h1 {
      text-align: center;
      color: white;
      margin-bottom: 40px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .demo-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-bottom: 40px;
    }
    
    .demo-card {
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    .demo-card h2 {
      margin-bottom: 10px;
      color: #333;
    }

    .badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .badge-good {
      background: #d4edda;
      color: #155724;
    }

    .badge-bad {
      background: #f8d7da;
      color: #721c24;
    }

    .badge-server {
      background: #d1ecf1;
      color: #0c5460;
    }

    .info-box {
      background: #e7f3ff;
      border-left: 4px solid #667eea;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 4px;
    }

    .info-box p {
      color: #333;
      font-size: 14px;
      line-height: 1.6;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #555;
    }

    input, select, textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      font-family: inherit;
    }

    textarea {
      min-height: 100px;
      resize: vertical;
    }

    button {
      background: #667eea;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
      transition: background 0.3s ease;
    }

    button:hover {
      background: #764ba2;
    }

    .success-message {
      display: none;
      background: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
      padding: 15px;
      border-radius: 6px;
      margin-top: 15px;
    }

    .debug-section {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 6px;
      padding: 20px;
      margin-top: 30px;
    }

    .debug-section h3 {
      margin-bottom: 15px;
      color: #333;
    }

    .debug-output {
      background: #282c34;
      color: #61dafb;
      padding: 15px;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 200px;
      overflow-y: auto;
      word-break: break-all;
    }

    .comparison-section {
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    .comparison-section h2 {
      margin-bottom: 20px;
      color: #333;
    }

    .comparison-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 8px;
      overflow: hidden;
    }

    .comparison-table th,
    .comparison-table td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }

    .comparison-table th {
      background: #f8f9fa;
      font-weight: 700;
      color: #333;
    }

    @media (max-width: 1024px) {
      .demo-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MM6H8SQW"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div class="container">
    <!-- Educational Demo Notice -->
    <div class="educational-notice">
      <div class="educational-notice-header">
        <h2>Educational Demonstration</h2>
      </div>
      
      <p><strong>This demonstrates server-side tracking architecture and code patterns.</strong> The implementation is production-ready, but this demo does not include actual server infrastructure.</p>
      
      <div class="notice-section">
        <p>What This Demo Provides:</p>
        <ul>
          <li>Correct client-side code structure</li>
          <li>Proper validation patterns</li>
          <li>Transaction ID generation for deduplication</li>
          <li>DataLayer event architecture</li>
        </ul>
      </div>
      
      <div class="notice-section">
        <p>What's Not Included (For Full Production):</p>
        <ul>
          <li>Deployed server container (requires Google Cloud Run/AWS)</li>
          <li>Custom domain configuration (<code>track.yourdomain.com</code>)</li>
          <li>DNS CNAME records and SSL certificates</li>
          <li>Server-side tag configuration in GTM</li>
        </ul>
      </div>
      
      <div class="notice-footer">
        <p>
          <strong>Full Implementation Guide:</strong> 
          See <a href="https://github.com/stiigg/gtm-ga4-form-tracking-demo">repository documentation</a><br/>
          <strong>Setup Time:</strong> ~3-5 hours | 
          <strong>Monthly Cost:</strong> $50-100 (DIY) or $19-99 (managed solutions like Stape.io)
        </p>
      </div>
    </div>

    <h1>GTM/GA4 Form Tracking: Complete Comparison</h1>
    
    <div class="demo-grid">
      <!-- BAD: Client-Side Only (No Validation) -->
      <div class="demo-card">
        <h2>BAD: Client-Side (No Validation)</h2>
        <span class="badge badge-bad">Anti-pattern</span>
        
        <div class="info-box">
          <p><strong>Problems:</strong><br/>
          • Fires on click (not success)<br/>
          • Ad blockers block 25-35%<br/>
          • High-cardinality fields<br/>
          • No deduplication</p>
        </div>
        
        <form id="bad-form">
          <div class="form-group">
            <label for="bad-name">Name</label>
            <input type="text" id="bad-name">
          </div>
          <div class="form-group">
            <label for="bad-email">Email</label>
            <input type="email" id="bad-email">
          </div>
          <div class="form-group">
            <label for="bad-message">Message</label>
            <textarea id="bad-message"></textarea>
          </div>
          <button type="button" id="bad-submit">Submit (Bad)</button>
        </form>
        
        <div class="success-message" id="bad-success">
          Fired! (Even if invalid)
        </div>
        
        <div class="debug-section">
          <h3>Tracking Method</h3>
          <p>Direct GA4 call (blocked by ad blockers)</p>
          <p>No validation</p>
          <div class="debug-output" id="bad-debug">Waiting for button click...</div>
        </div>
      </div>
      
      <!-- GOOD: Client-Side with Validation -->
      <div class="demo-card">
        <h2>GOOD: Client-Side (Validated)</h2>
        <span class="badge badge-good">Best Practice</span>
        
        <div class="info-box">
          <p><strong>Improvements:</strong><br/>
          • Validation-first approach<br/>
          • Clean event structure<br/>
          • Anti-double-fire guard<br/>
          • Still affected by ad blockers</p>
        </div>
        
        <form id="good-form">
          <div class="form-group">
            <label for="good-name">Name *</label>
            <input type="text" id="good-name" required>
          </div>
          <div class="form-group">
            <label for="good-email">Email *</label>
            <input type="email" id="good-email" required>
          </div>
          <div class="form-group">
            <label for="good-topic">Topic *</label>
            <select id="good-topic" required>
              <option value="">Select...</option>
              <option value="support">Support</option>
              <option value="sales">Sales</option>
              <option value="partnership">Partnership</option>
            </select>
          </div>
          <div class="form-group">
            <label>Plan *</label>
            <input type="radio" id="good-basic" name="plan" value="basic" required>
            <label for="good-basic" style="display:inline;margin-left:8px">Basic</label><br/>
            <input type="radio" id="good-pro" name="plan" value="pro" required>
            <label for="good-pro" style="display:inline;margin-left:8px">Pro</label>
          </div>
          <button type="submit">Submit (Good)</button>
        </form>
        
        <div class="success-message" id="good-success">
          Success! Event pushed to dataLayer (GTM will send to GA4)
        </div>
        
        <div class="debug-section">
          <h3>Tracking Method</h3>
          <p>Validated dataLayer push</p>
          <p>Still client-side (25-35% loss)</p>
          <div class="debug-output" id="good-debug">Waiting for form submission...</div>
        </div>
      </div>
      
      <!-- BEST: Server-Side with Hybrid Architecture -->
      <div class="demo-card">
        <h2>BEST: Server-Side (Hybrid)</h2>
        <span class="badge badge-server">Enterprise</span>
        
        <div class="info-box">
          <p><strong>Maximum Data Quality:</strong><br/>
          • Validation-first (same as good)<br/>
          • Bypasses ad blockers<br/>
          • Server-side enrichment<br/>
          • Event deduplication<br/>
          • 95%+ data accuracy</p>
        </div>
        
        <form id="server-form">
          <div class="form-group">
            <label for="server-name">Name *</label>
            <input type="text" id="server-name" required>
          </div>
          <div class="form-group">
            <label for="server-email">Email *</label>
            <input type="email" id="server-email" required>
          </div>
          <div class="form-group">
            <label for="server-topic">Topic *</label>
            <select id="server-topic" required>
              <option value="">Select...</option>
              <option value="support">Support</option>
              <option value="sales">Sales</option>
              <option value="partnership">Partnership</option>
            </select>
          </div>
          <div class="form-group">
            <label>Plan *</label>
            <input type="radio" id="server-basic" name="server-plan" value="basic" required>
            <label for="server-basic" style="display:inline;margin-left:8px">Basic</label><br/>
            <input type="radio" id="server-pro" name="server-plan" value="pro" required>
            <label for="server-pro" style="display:inline;margin-left:8px">Pro</label>
          </div>
          <button type="submit">Submit (Server-Side)</button>
        </form>
        
        <div class="success-message" id="server-success">
          Server-side event pushed with deduplication ID
        </div>
        
        <div class="debug-section">
          <h3>Tracking Method</h3>
          <p>Validated dataLayer push</p>
          <p>Routed through server container</p>
          <p>Ad blocker resistant</p>
          <p>Transaction ID deduplication</p>
          <div class="debug-output" id="server-debug">Waiting for validated submission...</div>
        </div>
      </div>
    </div>
    
    <!-- Comparison Table -->
    <div class="comparison-section">
      <h2>Implementation Comparison</h2>
      <table class="comparison-table">
        <thead>
          <tr>
            <th>Feature</th>
            <th>Bad (Client)</th>
            <th>Good (Client)</th>
            <th>Best (Server)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Validation</td>
            <td>None</td>
            <td>Yes</td>
            <td>Yes</td>
          </tr>
          <tr>
            <td>Ad Blocker Resistance</td>
            <td>0%</td>
            <td>0%</td>
            <td>95%+</td>
          </tr>
          <tr>
            <td>Data Accuracy</td>
            <td>~50%</td>
            <td>~65-75%</td>
            <td>~95%+</td>
          </tr>
          <tr>
            <td>Deduplication</td>
            <td>No</td>
            <td>Yes</td>
            <td>Yes (Enhanced)</td>
          </tr>
          <tr>
            <td>GDPR Compliance</td>
            <td>Weak</td>
            <td>Good</td>
            <td>Excellent</td>
          </tr>
          <tr>
            <td>Setup Complexity</td>
            <td>Low</td>
            <td>Medium</td>
            <td>High</td>
          </tr>
          <tr>
            <td>Maintenance</td>
            <td>Low</td>
            <td>Low</td>
            <td>Medium</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  
  <script>
    window.dataLayer = window.dataLayer || [];
    
    // BAD FORM
    document.getElementById('bad-submit').addEventListener('click', function() {
      window.dataLayer.push({
        event: 'contact_form',
        form_name: 'Contact Form',
        message: document.getElementById('bad-message').value
      });
      
      document.getElementById('bad-success').style.display = 'block';
      document.getElementById('bad-debug').innerHTML = `
        <strong>Tracking Status:</strong><br/>
        Fired without validation<br/>
        Likely blocked by ad blockers<br/>
        Estimated reach: ~50-65%<br/><br/>
        <strong>Event pushed:</strong><br/>
        ${JSON.stringify({
          event: 'contact_form',
          form_name: 'Contact Form',
          tracking_source: 'client_direct'
        }, null, 2)}
      `;
    });
    
    // GOOD FORM
    let goodSent = false;
    document.getElementById('good-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      if (goodSent) return;
      
      const name = document.getElementById('good-name').value;
      const email = document.getElementById('good-email').value;
      const topic = document.getElementById('good-topic').value;
      const plan = document.querySelector('input[name="plan"]:checked')?.value;
      
      if (!name || !email || !topic || !plan) {
        document.getElementById('good-debug').innerHTML = `
          <strong>Validation Failed:</strong><br/>
          Event NOT sent<br/>
          Required fields missing
        `;
        return;
      }
      
      await new Promise(resolve => setTimeout(resolve, 500));
      goodSent = true;
      
      window.dataLayer.push({
        event: 'form_submission_success',
        form_id: 'contact_us',
        form_type: 'lead',
        form_location: 'demo_page',
        tracking_source: 'client',
        form_fields: {
          topic: topic,
          plan: plan
        }
      });
      
      document.getElementById('good-success').style.display = 'block';
      document.getElementById('good-debug').innerHTML = `
        <strong>Tracking Status:</strong><br/>
        Validation passed<br/>
        Still affected by ad blockers<br/>
        Estimated reach: ~65-75%<br/><br/>
        <strong>Event pushed:</strong><br/>
        ${JSON.stringify({
          event: 'form_submission_success',
          form_id: 'contact_us',
          tracking_source: 'client'
        }, null, 2)}
      `;
    });
    
    // SERVER-SIDE FORM
    let serverSent = false;
    document.getElementById('server-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      if (serverSent) return;
      
      const name = document.getElementById('server-name').value;
      const email = document.getElementById('server-email').value;
      const topic = document.getElementById('server-topic').value;
      const plan = document.querySelector('input[name="server-plan"]:checked')?.value;
      
      if (!name || !email || !topic || !plan) {
        document.getElementById('server-debug').innerHTML = `
          <strong>Validation Failed:</strong><br/>
          Event NOT sent<br/>
          Required fields missing
        `;
        return;
      }
      
      await new Promise(resolve => setTimeout(resolve, 500));
      serverSent = true;
      
      const transactionId = `form_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
      
      window.dataLayer.push({
        event: 'form_submission_success',
        form_id: 'contact_us',
        form_type: 'lead',
        form_location: 'demo_page',
        tracking_source: 'server',
        transaction_id: transactionId,
        form_fields: {
          topic: topic,
          plan: plan
        }
      });
      
      document.getElementById('server-success').style.display = 'block';
      document.getElementById('server-debug').innerHTML = `
        <strong>Tracking Status:</strong><br/>
        Validation passed<br/>
        Routed through server container<br/>
        Ad blocker bypassed<br/>
        Transaction ID: ${transactionId}<br/>
        Estimated reach: ~95%+<br/><br/>
        <strong>Event pushed:</strong><br/>
        ${JSON.stringify({
          event: 'form_submission_success',
          form_id: 'contact_us',
          tracking_source: 'server',
          transaction_id: transactionId
        }, null, 2)}
        <br/><br/>
        <strong>Server Container will add:</strong><br/>
        • Server timestamp<br/>
        • IP geolocation (hashed)<br/>
        • User-agent details<br/>
        • Custom enrichment
      `;
    });
  </script>
</body>
</html>