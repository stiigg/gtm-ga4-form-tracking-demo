<!-- Product Detail Page - place in theme.liquid or product template -->
<script>
window.dataLayer = window.dataLayer || [];
dataLayer.push({
  event: 'view_item',
  ecommerce: {
    currency: '{{ cart.currency.iso_code }}',
    value: {{ product.price | money_without_currency }},
    items: [{
      item_id: '{{ product.variants.first.sku }}',
      item_name: '{{ product.title }}',
      item_brand: '{{ product.vendor }}',
      item_category: '{{ product.type }}',
      price: {{ product.price | money_without_currency }},
      quantity: 1
    }]
  }
});
</script>

<!-- Add to Cart - place in product-form.liquid -->
<script>
document.querySelector('form[action="/cart/add"]').addEventListener('submit', function(e) {
  e.preventDefault();
  const formData = new FormData(this);
  
  dataLayer.push({ecommerce: null});
  dataLayer.push({
    event: 'add_to_cart',
    ecommerce: {
      currency: '{{ cart.currency.iso_code }}',
      value: {{ product.price | money_without_currency }},
      items: [{
        item_id: '{{ product.variants.first.sku }}',
        item_name: '{{ product.title }}',
        price: {{ product.price | money_without_currency }},
        quantity: parseInt(formData.get('quantity'))
      }]
    }
  });
  
  // Submit form after dataLayer push
  setTimeout(() => this.submit(), 100);
});
</script>

<!-- Checkout Page - place in checkout.liquid (Shopify Plus required) -->
{% if first_time_accessed %}
<script>
dataLayer.push({
  event: 'begin_checkout',
  ecommerce: {
    currency: '{{ checkout.currency }}',
    value: {{ checkout.total_price | money_without_currency }},
    items: [
      {% for item in checkout.line_items %}
      {
        item_id: '{{ item.sku }}',
        item_name: '{{ item.title }}',
        price: {{ item.price | money_without_currency }},
        quantity: {{ item.quantity }}
      }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ]
  }
});
</script>
{% endif %}

<!-- Thank You Page - place in checkout success page -->
<script>
dataLayer.push({
  event: 'purchase',
  ecommerce: {
    transaction_id: '{{ order.order_number }}',
    affiliation: 'Shopify Store',
    value: {{ order.total_price | money_without_currency }},
    tax: {{ order.tax_price | money_without_currency }},
    shipping: {{ order.shipping_price | money_without_currency }},
    currency: '{{ order.currency }}',
    items: [
      {% for item in order.line_items %}
      {
        item_id: '{{ item.sku }}',
        item_name: '{{ item.title }}',
        price: {{ item.price | money_without_currency }},
        quantity: {{ item.quantity }}
      }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ]
  }
});
</script>
